<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<title>Chat example</title>
<script>
var connection
var nickname
window.addEventListener("load", function () {
	var nickname = String(prompt("Choose a nickname"))
	console.log(nickname);
	document.getElementById("connect").addEventListener("click", function () {
		// Synchronous request because we really need the socket now	
		console.log("Got here");
		httpGetAsync("/requestserver", createConn); // false for synchronous request
	})
})

function httpGetAsync(theUrl, callback)
{
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() { 
        if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
			console.log("Calling callback");
            callback(xmlHttp.responseText);
		}
		else {
			console.log("Something went wrong");
			console.log(xmlHttp.readyState, xmlHttp.status);
		}
    }
    xmlHttp.open("GET", theUrl, true); // true for asynchronous 
	xmlHttp.send(null);
}

function createConn(url) {
	console.log("Response is: " + url);
	connection = new WebSocket(url);
	attachConnCbs(connection);
}

function attachConnCbs(connection) {
	connection.onclose = function () {
		console.log("Connection closed")
	}
	connection.onerror = function () {
		console.error("Connection error")
	}
	connection.onmessage = function (event) {
		var div = document.createElement("div")
		div.textContent = event.data
		document.body.appendChild(div)
	}
}
</script>
</head>

<body>
    <button id="connect">Click me to connect to game_server</button>
</body>
</html>
